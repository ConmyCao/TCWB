const express = require('express');
const app = express();
const swaggerUi = require('swagger-ui-express');
const YAML = require('yamljs');
const fs = require('fs');

let source = fs.readFileSync('./swagger.yaml', 'utf8');
source = source.replace(/{token}/g, 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc0F1dGhvcml6ZSI6dHJ1ZSwibG9nZ2VkVXNlcklkIjoiNWI4ZjgwZDg3NzgwYTQzOGZjYTgzZjgyIiwic2Nob29sIjoiNWI4ZjgwZDg3NzgwYTQzOGZjYTgzZjdlIiwiYXV0aG9yaXplIjpbImdldF9tZXNzYWdlcyIsImNyZWF0ZV9tZXNzYWdlIiwibWVzc2FnZV9tYW5hZ2VfY2hlY2tBbGwiLCJnZXRfc2Nob29scyIsImNyZWF0ZV9zY2hvb2wiLCJtb2RpZnlfc2Nob29sIiwiZGVsZXRlX3NjaG9vbCIsInNjaG9vbF9tYW5hZ2VfY2hlY2tBbGwiLCJnZXRfY2xhc3NlcyIsImNyZWF0ZV9jbGFzcyIsIm1vZGlmeV9jbGFzcyIsImRlbGV0ZV9jbGFzcyIsImNsYXNzX21hbmFnZV9jaGVja0FsbCIsImdldF91c2VyX3JlYWxhdGlvbiIsImNyZWF0ZV91c2VyX3JlYWxhdGlvbiIsIm1vZGlmeV91c2VyX3JlYWxhdGlvbiIsImRlbGV0ZV91c2VyX3JlYWxhdGlvbiIsInVzZXJfcmVhbGF0aW9uX21hbmFnZV9jaGVja0FsbCIsImdldF90aW1ldGFibGVzIiwiY3JlYXRlX3RpbWV0YWJsZSIsIm1vZGlmeV90aW1ldGFibGUiLCJkZWxldGVfdGltZXRhYmxlIiwidGltZXRhYmxlX21hbmFnZV9jaGVja0FsbCIsImdldF9vZmZpY2lhbF9pbmZvIiwicHV0X29mZmljaWFsX2luZm8iLCJvZmZpY2lhbF9tYW5hZ2VfY2hlY2tBbGwiLCJnZXRfc2xpZGVfZ3JvdXBzIiwiY3JlYXRlX3NsaWRlX2dyb3VwIiwicHV0X3NsaWRlX2dyb3VwIiwiZGVsZXRlX3NsaWRlX2dyb3VwIiwic2xpZGVfZ3JvdXBfbWFuYWdlX2NoZWNrQWxsIiwiZ2V0X3NsaWRlcyIsImNyZWF0ZV9zbGlkZXMiLCJwdXRfc2xpZGVzIiwiZGVsZXRlX3NsaWRlcyIsInNsaWRlc19tYW5hZ2VfY2hlY2tBbGwiLCJnZXRfZmVhdHVyZV9ncm91cHMiLCJjcmVhdGVfZmVhdHVyZV9ncm91cCIsInB1dF9mZWF0dXJlX2dyb3VwIiwiZGVsZXRlX2ZlYXR1cmVfZ3JvdXAiLCJmZWF0dXJlX2dyb3VwX21hbmFnZV9jaGVja0FsbCIsImdldF9zY2hvb2xfcmVzb3VyY2VzIiwiY3JlYXRlX3NjaG9vbF9yZXNvdXJjZSIsImRlbGV0ZV9zY2hvb2xfcmVzb3VyY2UiLCJzY2hvb2xfcmVzb3VyY2VfbWFuYWdlX2NoZWNrQWxsIiwiZ2V0X3BvcnRhbHMiLCJjcmVhdGVfcG9ydGFsIiwicHV0X3BvcnRhbCIsImRlbGV0ZV9wb3J0YWwiLCJwb3J0YWxfbWFuYWdlX2NoZWNrQWxsIiwiZ2V0X2FydGljbGVzIiwiY3JlYXRlX2FydGljbGUiLCJwdXRfYXJ0aWNsZSIsImRlbGV0ZV9hcnRpY2xlIiwiYXJ0aWNsZV9tYW5hZ2VfY2hlY2tBbGwiLCJnZXRfbXlfcmVzb3VyY2VzIiwiY3JlYXRlX215X3Jlc291cmNlIiwiZGVsZXRlX215X3Jlc291cmNlIiwibXlfcmVzb3VyY2VfbWFuYWdlX2NoZWNrQWxsIiwiZ2V0X3NjaGVkdWxlcyIsImNyZWF0ZV9zY2hlZHVsZSIsIm1vZGlmeV9zY2hlZHVsZSIsImRlbGV0ZV9zY2hlZHVsZSIsImRlbGV0ZV9zY2hlZHVsZV9yZW1vdmVkRGF0ZSIsInNjaGVkdWxlX21hbmFnZV9jaGVja0FsbCIsImdldF9yb2xlcyIsImNyZWF0ZV9yb2xlIiwibW9kaWZ5X3JvbGUiLCJkZWxldGVfcm9sZSIsInJvbGVfbWFuYWdlX2NoZWNrQWxsIiwiZ2V0X3VzZXJzIiwiY3JlYXRlX3VzZXIiLCJtb2RpZnlfdXNlciIsImRlbGV0ZV91c2VyIiwidXNlcl9tYW5hZ2VfY2hlY2tBbGwiLCJwdXRfcm9sZV9hdXRob3JpemF0aW9uIiwiZ2V0X3JvbGVfYXV0aG9yaXphdGlvbiJdLCJpYXQiOjE1MzYxMzE1NzgsImV4cCI6MTU2NzY4OTE3OH0.P2nnpRe5hlx6cSrazYb09NkUtF7wG0mCGtVe6DsWJ');
source = source.replace(/{schoolId}/g, '5b7fa5200ffb4a33647f43a1');
fs.writeFileSync('./swagger-prod.yaml', source);

const swaggerDocument = YAML.load('./swagger-prod.yaml');

app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(swaggerDocument));

app.listen(4567, () => {
    console.log('swagger started at 4567')
})